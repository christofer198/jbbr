<!DOCTYPE html>
<html>
  <head>
    <title>TinderJobs</title>
    <%= csrf_meta_tags %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>


    <% if session[:user_id] %>
      <p>Logged in as <%= User.find(session[:user_id]).name %>
        <a href="/profile"> <%= button_tag "Preferences" %>
        <a href="/logout"> <%= button_tag "Logout" %> </a></p>
      <% @user = User.find(session[:user_id]) %>


    <h1>Session type: <%= session[:type] == 1 ? 'Applicant' : 'Company' %></h1>

    <% if session[:type] == -1 %>

        <%= link_to "Your #{Company.find(@user.company_id).name} Employee Page", company_path(@user.company_id) %>

      <% if Company.find(@user.company_id).openings.any? %>
        <p> <a href='/companies/<%=@user.company_id%>'>Openings: <%= Company.find(@user.company_id).openings.count %> </a>
        <p> <a href='/openings/new'> Add more openings</a><br>
        <p> <a href='/matches'> Matches: <%= @user.company_matches.count %> </a></p>
        <%= link_to 'Match with Applicants', applications_path %>
      <% else %>
        <% if Company.find(@user.company_id).openings.count > 0 %>
          <p> Openings: <%= Company.find(@user.company_id).openings.count %> </p>
        <% else %>
          <%= link_to "Create An Opening", new_opening_path %>
        <% end %>

      <% end %>

      <%= form_tag request.original_url, method: :get do %>
        <%= hidden_field_tag 'session_flipper', -1 %>
        <%= submit_tag 'Switch to Employee View' %>
      <% end %>


    <% else %>
      <p>Applications Swiped: <%= @user.applications.count %> </p>
      <%= link_to 'Match with Companies', openings_path %>
      <p> <a href='/matches'> Matches: <%= @user.user_matches.count %> </a></p>

      <% if @user.company_id == nil %>
        <%= link_to "Become an Employer", new_company_path %>
      <% else %>

      <%= form_tag request.original_url, method: :get do %>
        <%= hidden_field_tag 'session_flipper', -1 %>
        <%= submit_tag 'Switch to Company View' %>
      <% end %>

      <% end %>

    <% end %>

    <% flash.each do |key, value| %>
    <em><%= value %></em>
    <% end %>

  <% end %>
    <%= yield %>




  </body>
</html>
